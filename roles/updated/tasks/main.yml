---


- name: Upload updated yum repos
  template:
    src: "{{ item }}"
    dest: "/etc/yum.repos.d/"
    mode: 0644
    owner: "root"
    group: "root"
  with_fileglob:
    - "templates/yum.repos.d/*"


- name: Install Tools
  yum:
    name:
      - git
      - rsync
      - wget
      - yum-utils
      - python36
    state: present

- name: Upgrade all packages
  yum:
    name: '*'
    state: latest

- name: Check if we need to restart
  shell: /usr/bin/needs-restarting -r
  register: needs_restarting
  failed_when: needs_restarting.rc >= 2


- name: reboot
  reboot:
  when: needs_restarting.rc != 0