{{ ansible_managed | comment('xml') }}

<configuration>

    <property>
        <name>mapreduce.admin.map.child.java.opts</name>
        <value>-server -XX:NewRatio=8 -Djava.net.preferIPv4Stack=true</value>
    </property>

    <property>
        <name>mapreduce.admin.reduce.child.java.opts</name>
        <value>-server -XX:NewRatio=8 -Djava.net.preferIPv4Stack=true</value>
    </property>

    <property>
        <name>mapreduce.am.max-attempts</name>
        <value>2</value>
    </property>

    <property>
        <name>mapreduce.application.classpath</name>
        <value>
            $HADOOP_MAPRED_HOME/share/hadoop/mapreduce/*,$HADOOP_MAPRED_HOME/share/hadoop/mapreduce/lib/*,$PWD/mr-framework/*,/etc/hadoop/conf/
        </value>
    </property>

    <property>
        <name>mapreduce.application.framework.path</name>
        <value>/system/mapreduce/mapreduce.tar.gz#mr-framework</value>
    </property>

    <property>
        <name>mapreduce.client.submit.file.replication</name>
        <value>3</value>
    </property>

    <property>
        <name>mapreduce.cluster.acls.enabled</name>
        <value>true</value>
    </property>

    <property>
        <name>mapreduce.cluster.administrators</name>
        <value>{{mapreduce_user.name}} {{ hadoop_group.name }},{{subadmins_group.name}}</value>
    </property>

    <property>
        <name>mapreduce.containers.per.disk</name>
        <value>4</value>
    </property>

    <property>
        <name>mapreduce.framework.name</name>
        <value>yarn</value>
    </property>

    <property>
        <name>mapreduce.job.counters.max</name>
        <value>130</value>
    </property>

    <property>
        <name>mapreduce.job.emit-timeline-data</name>
        <value>true</value>
    </property>

    <property>
        <name>mapreduce.job.queuename</name>
        <value>default</value>
    </property>

    <property>
        <name>mapreduce.job.reduce.slowstart.completedmaps</name>
        <value>0.05</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.address</name>
        <value>{{ mapreduce_history_server_host }}:{{mapreduce_history_server_rpc_port}}</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.admin.acl</name>
        <value>{{yarn_user.name}} {{subadmins_group.name}}</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.admin.address</name>
        <value>{{ mapreduce_history_server_host }}:{{mapreduce_history_server_admin_port}}</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.bind-host</name>
        <value>0.0.0.0</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.cleaner.enable</name>
        <value>true</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.done-dir</name>
        <value>{{mapreduce.jobhistory.dir}}/done</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.http.policy</name>
        <value>HTTPS_ONLY</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.intermediate-done-dir</name>
        <value>{{mapreduce.jobhistory.dir}}/tmp</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.joblist.cache.size</name>
        <value>100000</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.keytab</name>
        <value>{{ keytab_dir }}/{{ mapreduce_historyserver_service_name }}.service.keytab</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.max-age-ms</name>
        <value>2592000000</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.principal</name>
        <value>{{ mapreduce_historyserver_service_name }}/_HOST@{{ ipaserver_realm }}</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.recovery.enable</name>
        <value>true</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.recovery.store.class</name>
        <value>org.apache.hadoop.mapreduce.v2.hs.HistoryServerLeveldbStateStoreService</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.recovery.store.leveldb.path</name>
        <value>{{mapreduce_jobhistory_recovery_store_leveldb_path}}</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.webapp.address</name>
        <value>{{ mapreduce_history_server_host }}:{{mapreduce_history_server_http_port}}</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.webapp.https.address</name>
        <value>{{ mapreduce_history_server_host }}:{{mapreduce_history_server_https_port}}</value>
        <description>
            The https address the MapReduce JobHistory Server WebApp is on.
        </description>
    </property>

    <property>
        <name>mapreduce.jobhistory.webapp.spnego-keytab-file</name>
        <value>{{keytab_dir}}/spnego.service.keytab</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.webapp.spnego-principal</name>
        <value>HTTP/_HOST@{{ ipaserver_realm }}</value>
    </property>

    <property>
        <name>mapreduce.map.java.opts</name>
        <value>-Xmx{{ mapreduce_map_java_memory }}</value>
    </property>

    <property>
        <name>mapreduce.map.log.level</name>
        <value>INFO</value>
    </property>

    <property>
        <name>mapreduce.map.memory.mb</name>
        <value>{{ mapreduce_map_yarn_memory }}</value>
    </property>

    <property>
        <name>mapreduce.map.output.compress</name>
        <value>true</value>
    </property>

    <property>
        <name>mapreduce.map.sort.spill.percent</name>
        <value>0.7</value>
    </property>

    <property>
        <name>mapreduce.map.speculative</name>
        <value>false</value>
    </property>

    <property>
        <name>mapreduce.output.fileoutputformat.compress</name>
        <value>false</value>
    </property>

    <property>
        <name>mapreduce.output.fileoutputformat.compress.type</name>
        <value>BLOCK</value>
    </property>

    <property>
        <name>mapreduce.reduce.input.buffer.percent</name>
        <value>0.0</value>
    </property>

    <property>
        <name>mapreduce.reduce.java.opts</name>
        <value>-Xmx{{mapreduce_reduce_java_memory}}</value>
    </property>

    <property>
        <name>mapreduce.reduce.log.level</name>
        <value>INFO</value>
    </property>

    <property>
        <name>mapreduce.reduce.memory.mb</name>
        <value>{{mapreduce_reduce_yarn_memory}}</value>
    </property>

    <property>
        <name>mapreduce.reduce.shuffle.fetch.retry.enabled</name>
        <value>1</value>
    </property>

    <property>
        <name>mapreduce.reduce.shuffle.fetch.retry.interval-ms</name>
        <value>1000</value>
    </property>

    <property>
        <name>mapreduce.reduce.shuffle.fetch.retry.timeout-ms</name>
        <value>30000</value>
    </property>

    <property>
        <name>mapreduce.reduce.shuffle.input.buffer.percent</name>
        <value>0.7</value>
    </property>

    <property>
        <name>mapreduce.reduce.shuffle.merge.percent</name>
        <value>0.66</value>
    </property>

    <property>
        <name>mapreduce.reduce.shuffle.parallelcopies</name>
        <value>30</value>
    </property>

    <property>
        <name>mapreduce.reduce.speculative</name>
        <value>false</value>
    </property>

    <property>
        <name>mapreduce.shuffle.port</name>
        <value>{{mapreduce_shuffle_port}}</value>
    </property>

    <property>
        <name>mapreduce.task.io.sort.factor</name>
        <value>100</value>
    </property>

    <property>
        <name>mapreduce.task.io.sort.mb</name>
        <value>{{mapreduce_task_sort_memory}}</value>
    </property>

    <property>
        <name>mapreduce.task.timeout</name>
        <value>300000</value>
    </property>

    <property>
        <name>yarn.app.mapreduce.am.command-opts</name>
        <value>-Xmx{{mapreduce_am_java_memory}}</value>
    </property>

    <property>
        <name>yarn.app.mapreduce.am.log.level</name>
        <value>INFO</value>
    </property>

    <property>
        <name>yarn.app.mapreduce.am.resource.mb</name>
        <value>{{mapreduce_am_yarn_memory}}</value>
    </property>

    <property>
        <name>yarn.app.mapreduce.am.staging-dir</name>
        <value>/user</value>
    </property>

    <property>
        <name>yarn.app.mapreduce.client.job.max-retries</name>
        <value>30</value>
    </property>

    <property>
        <name>yarn.app.mapreduce.am.job.client.port-range</name>
        <value>{{mapreduce_am_portrange}}</value>
        <description>Range of ports that the MapReduce AM can use when binding.
            Leave blank if you want all possible ports.
            For example 50000-50050,50100-50200
        </description>
    </property>

    <property>
        <name>yarn.app.mapreduce.am.webapp.port-range</name>
        <value>{{mapreduce_am_portrange}}</value>
        <description>Range of ports that the MapReduce AM can use for its webapp when binding.
            Leave blank if you want all possible ports.
            For example 50000-50050,50100-50200
        </description>
    </property>


    <property>
        <name>yarn.app.mapreduce.am.env</name>
        <value>HADOOP_MAPRED_HOME={{current_hadoop_home}}</value>
    </property>
    <property>
        <name>mapreduce.map.env</name>
        <value>HADOOP_MAPRED_HOME={{current_hadoop_home}}</value>
    </property>
    <property>
        <name>mapreduce.reduce.env</name>
        <value>HADOOP_MAPRED_HOME={{current_hadoop_home}}</value>
    </property>


</configuration>